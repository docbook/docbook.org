<html xmlns="http://www.w3.org/1999/xhtml"><head><title>DocBook Transclusion</title><meta charset="utf-8" /><meta name="generator" content="DocBook XSL 2.0 Stylesheets V2.4.3" /><link href="https://cdn.docbook.org/resources/2.1.1/css/default.css" rel="stylesheet" type="text/css" /><link href="https://cdn.docbook.org/resources/2.1.1/css/db-prism.css" rel="stylesheet" type="text/css" /><script type="text/javascript" src="https://cdn.docbook.org/resources/2.1.1/js/dbmodnizr.js"></script></head><body><article id="transclusion" class="article"><header class="article-titlepage"><h2>DocBook Transclusion</h2><div class="authorgroup"><div class="author"><h3><span class="personname"><span class="firstname">Jirka</span> <span class="surname">Kosek</span></span></h3></div></div><div><p>08 Jan 2015</p></div></header><div class="lists-of-titles"><div class="toc"><div class="title">Table of Contents</div><ul class="toc"><li><span><a href="#intro"><span class="label">1. </span>Introduction</a></span></li><li><span><a href="#processing"><span class="label">2. </span>Transclusion processing</a></span></li><li><span><a href="#using-xinclude"><span class="label">A. </span>Using XInclude 1.1 features for your content</a></span></li><li><span><a href="#tutorial"><span class="label">B. </span>Special ID/IDREF processing</a></span></li><li><span><a href="#schema"><span class="label">C. </span>DocBook schema with support for transclusions</a></span></li><li><span><a href="#transclusion-processor"><span class="label">D. </span>Sample transclusion processor written in XSLT 2.0</a></span></li><li><span><a href="#bibliography"><span class="label"></span>Bibliography</a></span></li></ul></div></div><div class="content"><section id="intro" class="section"><div class="section-titlepage"><h2>1. Introduction</h2></div><div class="content"><p>This document describes the syntax, semantics, and processing model
for the DocBook transclusion mechanism. Please be aware that this is a
working draft – everything described below might change or disappear
completely. This proposal addresses the issues described in <em class="citetitle"><a href="https://docbook.org/docs/transclusion-requirements/">Requirements
for transclusion in DocBook</a></em>.  The DocBook TC welcomes
feedback on this draft, especially from users and developers of
DocBook authoring and processing tools. Please direct your comments to
the DocBook mailing list by sending email to
<code class="email">&lt;<a href="mailto:docbook@lists.oasis-open.org">docbook@lists.oasis-open.org</a>&gt;</code>.</p><div class="note admonition"><h3>Note</h3><div class="admonition-body"><p>Previous version of this draft proposed the new elements
<code class="tag-element">ref</code> and <code class="tag-element">def</code> for implementing
transclusions. Meanwhile DocBook TC decided that transclusions should
rely as much as possible on standard technologies. XInclude 1.1 added
new features that allow to implement transclusion features on
top of the XInclude. As a result transclusions were completely
redesigned to be layered on top of XInclude 1.1.</p><p>This resulted in a loss of some features. For example, it's no longer
possible to locally redefine text replacement (see this <a href="https://docbook.org/docs/transclusion/2011-04-20/transclusion.html#d6e65">example</a> from the April 20, 2014 draft of this document).</p></div></div><p>The following namespace bindings are used as prefixes in this document:</p><div class="variablelist"><dl><dt><span class="term"><code class="tag-prefix">trans</code></span></dt><dd><p>DocBook transclusion namespace
(<code class="uri">http://docbook.org/ns/transclusion</code>)</p></dd><dt><span class="term"><code class="tag-prefix">db</code></span></dt><dd><p>DocBook namespace
(<code class="uri">http://docbook.org/ns/docbook</code>)</p></dd><dt><span class="term"><code class="tag-prefix">xi</code></span></dt><dd><p>XInclude namespace
(<code class="uri">http://www.w3.org/2001/XInclude</code>)</p></dd><dt><span class="term"><code class="tag-prefix">local</code></span></dt><dd><p>XInclude namespace for copying attributes without a namespace
(<code class="uri">http://www.w3.org/2001/XInclude/local-attributes</code>)</p></dd></dl></div></div></section><section id="processing" class="section"><div class="section-titlepage"><h2>2. Transclusion processing</h2></div><div class="content"><p>The processing model for transclusion is simple and cosists of the following steps:</p><div class="orderedlist"><ol style="list-style: decimal;"><li><p>Normal XInclude 1.1 processing on the input document.</p></li><li><p>DocBook transclusion processing on the result to fix problems such as
  duplicate IDs and broken cross-references.</p></li><li><p>Normal processing on the resulting document using the DocBook stylesheets or equivalent tools.</p></li></ol></div><p>Transclusion processing is controlled by 
attributes from the <code class="uri">http://docbook.org/ns/transclusion</code>
namespace. These attributes are typically inserted into a
document by using the attribute copying feature of XInclude 1.1 [<a href="#XI11"></a>], which
is described in section <em class="citetitle"><a href="https://www.w3.org/XML/2012/08/xinclude-11/Overview.html#attribute-copying">4.3
Attribute Copying when processing XML</a></em> of the XInclude 1.1 specification.</p><p>The transclusion processor copies documents node by node. For most
nodes this is an identity transformation. The few exceptions are
controlled by transclusion properties. Transclusion properties
<span class="property">suffix</span> and <span class="property">linkscope</span> are
defined for each node in the document as follows:</p><div class="variablelist"><dl><dt id="suffix"><span class="term">suffix</span></dt><dd><div class="itemizedlist"><ul><li>Defines a value to be appended to all ID values on the element
    (elements and attributes whose values should be treated as IDs are listed in the <span class="property">ID-list</span> property)</li><li>Default is an empty string</li><li>Inherited</li><li>Can be changed by the
    <code class="tag-attribute">trans:idfixup</code> and
    <code class="tag-attribute">trans:suffix</code> attributes</li></ul></div></dd><dt id="linkscope"><span class="term">linkscope</span></dt><dd><div class="itemizedlist"><ul><li>Defines how to correct
    ID references (elements and attributes whose values should be treated as ID references are
    listed in the <span class="property">IDREF-list</span> property)</li><li>Allowed values are <code class="code">user</code>, <code class="code">local</code>,
    <code class="code">near</code>, and <code class="code">global</code></li><li>Default value is <code class="code">near</code></li><li>Inherited</li><li>Can be changed by the
    <code class="tag-attribute">trans:linkscope</code> attribute</li></ul></div></dd></dl></div><p>For each document type there are two properties,
<span class="property">ID-list</span> and <span class="property">IDREF-list</span>, which
control the transclusion process. The <span class="property">ID-list</span>
property defines the attributes and elements whose values should be treated as IDs.
Similarly, the  <span class="property">IDREF-list</span> property defines the attributes
and elements whose values should be treated as ID references.
These properties are defined for DocBook 5.0 in <a href="#docbook-lists-definition">Definition of ID-list and IDREF-list properties for DocBook 5.0</a>.
Transclusion processors are free to support the <span class="property">ID-list</span> and
<span class="property">IDREF-list</span> properties with other document
types, for example DocBook 4.x or TEI.</p><p>ID references identified in the <span class="property">IDREF-list</span> are corrected as follows:</p><div class="variablelist"><dl><dt><span class="term">When <code class="code">linkscope=user</code></span></dt><dd><p>No adjustment is made.</p></dd><dt><span class="term">When <code class="code">linkscope=local</code></span></dt><dd><p>The value of the <span class="property">suffix</span> property is added to every ID reference as a suffix.</p></dd><dt><span class="term">When <code class="code">linkscope=near</code></span></dt><dd><p>Each ID reference is adjusted to point to
the closest element that has a <a href="#matching-id">matching ID</a>.</p><p>To find the closest element, the parent element of the element that contains the ID reference is searched for a matching ID, followed by that element's descendants.
If no matching ID is found, that element's parent is inspected in the same way. This continues until a match is found or the
root element is reached.</p></dd><dt><span class="term">When <code class="code">linkscope=global</code></span></dt><dd><p>Each ID reference is adjusted to point to
the first element in document order that has a <a href="#matching-id">matching ID</a>.</p></dd></dl></div><p id="matching-id">A <em>matching ID</em> does not mean exact string equality
between ID and IDREF values. A matching ID means that the values of an ID and IDREF match after removing any added suffixes.</p><p>Transclusion properties can be set on any element using the following attributes:</p><div class="variablelist"><dl><dt id="idfixup-attribute"><span class="term"><code class="tag-attribute">trans:idfixup</code> attribute</span></dt><dd><div class="variablelist"><dl><dt><span class="term">value <code class="tag-attvalue">none</code></span></dt><dd><p>The <span class="property">suffix</span> property is set to an empty string.</p></dd><dt><span class="term">value <code class="tag-attvalue">suffix</code></span></dt><dd><p>The <span class="property">suffix</span> property is set to the concatenation
of the inherited suffix value and the value specified in the <code class="tag-attribute">trans:suffix</code> attribute.</p></dd><dt><span class="term">value <code class="tag-attvalue">auto</code></span></dt><dd><p>The <span class="property">suffix</span> property is set to a unique value
for each element.<sup class="footnote"><span class="osq">[</span><a id="idfixup-attribute.2.1.3.2.1.2" href="#ftn.idfixup-attribute.2.1.3.2.1.2">1</a><span class="csq">]</span></sup></p></dd></dl></div></dd><dt id="suffix-attribute"><span class="term"><code class="tag-attribute">trans:suffix</code> attribute</span></dt><dd><p>This attribute defines the value of the <span class="property">suffix</span> property used when <code class="code">trans:idfixup="suffix"</code>.</p><p>It's an error to use this attribute when the attribute/value pair <code class="code">trans:idfixup="suffix"</code> is not also on the element.</p></dd><dt id="linkscope-attribute"><span class="term"><code class="tag-attribute">trans:linkscope</code> attribute</span></dt><dd><p>Sets the value of the <span class="property">linkscope</span> property.
  Permitted values are: <code class="code">user</code>, <code class="code">local</code>, <code class="code">near</code>, and <code class="code">global</code>.</p></dd></dl></div><p>During the transclusion process all attributes from the transclusion
namespace are removed from the resulting document.</p><div id="docbook-lists-definition" class="variablelist"><div class="title">Definition of ID-list and IDREF-list properties for DocBook 5.0</div><p>In DocBook 5.0, the <span class="property">ID-list</span> and <span class="property">IDREF-list</span> properties contain the attributes shown here:</p><dl><dt><span class="term"><span class="property">ID-list</span></span></dt><dd><p><code class="tag-attribute">xml:id</code></p></dd><dt><span class="term"><span class="property">IDREF-list</span></span></dt><dd><p>
<code class="tag-attribute">linkend</code>,
<code class="tag-attribute">linkends</code>,
<code class="tag-attribute">otherterm</code>,
<code class="tag-attribute">zone</code>,
<code class="tag-attribute">startref</code>,
<code class="tag-attribute">arearefs</code>,
<code class="tag-attribute">targetptr</code>, and
<code class="tag-attribute">endterm</code>.</p><p>The <code class="tag-attribute">href</code> attribute in the XLink
namespace is considered a member of <span class="property">IDREF-list</span> when its value begins with <code class="code">#</code>.</p></dd></dl></div></div></section><article id="using-xinclude" class="appendix"><header class="appendix-titlepage"><h2>A. Using XInclude 1.1 features for your content</h2></header><div class="content"><p>The most common transclusion scenario is reuse of shared strings
(see <a href="https://docbook.org/docs/transclusion-requirements/transclusion-requirements.html#uc-1">https://docbook.org/docs/transclusion-requirements/transclusion-requirements.html#uc-1</a>). With
XInclude 1.0 this could only be done using XPointer schemes that
were not very interoperable. With XInclude 1.1, doing this is much easier.</p><p>Let's assume we have defined a set of shared strings in separate document (see <a href="#ex.1">Example A.1, “Definitions stored in a separate document (<code class="filename">definitions.001.xml</code>)”</a>).</p><figure id="ex.1" class="example-wrapper"><div class="title">Example A.1. Definitions stored in a separate document (<code class="filename">definitions.001.xml</code>)</div><div class="example"><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;&#xD;
  &lt;title&gt;Placeholder for definitions&lt;/title&gt;&#xD;
  &lt;para&gt;&#xD;
    &lt;phrase xml:id="product-version"&gt;3.14&lt;/phrase&gt;&#xD;
    &lt;phrase xml:id="product-name"&gt;FooWiz&lt;/phrase&gt;&#xD;
    &lt;phrase xml:id="corp-name"&gt;ACME Inc.&lt;/phrase&gt;&#xD;
  &lt;/para&gt;&#xD;
&lt;/article&gt;</code></pre></div></figure><p>If you transclude parts of this document as shown in <a href="#ex.2">Example A.2, “Transclusion with duplicate IDs”</a>, you will end up with duplicate IDs.
In this example, the same definition is included twice. Because the ID attributes are passed through unchanged, the ID value “<span class="quote">product-name</span>” occurs twice in the resulting document.</p><figure id="ex.2" class="example-wrapper"><div class="title">Example A.2. Transclusion with duplicate IDs</div><div class="example"><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&#xD;
  xmlns:xi="http://www.w3.org/2001/XInclude"&gt;&#xD;
  &lt;info&gt;&#xD;
    &lt;title&gt;Transclusions demo&lt;/title&gt;&#xD;
  &lt;/info&gt;&#xD;
  &lt;para&gt;The latest version of&#xD;
    &lt;application&gt;&lt;xi:include href="definitions.001.xml" xpointer="product-name"/&gt;&lt;/application&gt; from&#xD;
    &lt;xi:include href="definitions.001.xml" xpointer="corp-name"/&gt;&#xD;
    is &lt;xi:include href="definitions.001.xml" xpointer="product-version"/&gt;.&lt;/para&gt;&#xD;
  &lt;para&gt;You can buy &lt;xi:include href="definitions.001.xml" xpointer="product-name"/&gt; in our on-line store.&lt;/para&gt;&#xD;
&lt;/article&gt;</code></pre><p>Result of transclusion:</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;
  &lt;info&gt;
      &lt;title&gt;Transclusions demo&lt;/title&gt;
  &lt;/info&gt;
  &lt;para&gt;The latest version of
    &lt;application&gt;
         &lt;phrase xml:base="definitions.001.xml" xml:id="product-name"&gt;FooWiz&lt;/phrase&gt;
      &lt;/application&gt; from
    &lt;phrase xml:base="definitions.001.xml" xml:id="corp-name"&gt;ACME Inc.&lt;/phrase&gt;
    is &lt;phrase xml:base="definitions.001.xml" xml:id="product-version"&gt;3.14&lt;/phrase&gt;.&lt;/para&gt;
  &lt;para&gt;You can buy &lt;phrase xml:base="definitions.001.xml" xml:id="product-name"&gt;FooWiz&lt;/phrase&gt; in our on-line store.&lt;/para&gt;
&lt;/article&gt;
</code></pre></div></figure><p>XInclude 1.1 has an attribute, <code class="tag-attribute">set-xml-id</code>,
which can be used to change or remove the  <code class="tag-attribute">xml:id</code>
attribute on included content. <a href="#ex.3">Example A.3, “Using <code class="tag-attribute">set-xml-id</code> to remove the top-level ID during transclusion”</a> uses this attribute to avoid duplicate IDs.</p><figure id="ex.3" class="example-wrapper"><div class="title">Example A.3. Using <code class="tag-attribute">set-xml-id</code> to remove the top-level ID during transclusion</div><div class="example"><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&#xD;
  xmlns:xi="http://www.w3.org/2001/XInclude"&gt;&#xD;
  &lt;info&gt;&#xD;
    &lt;title&gt;Transclusions demo&lt;/title&gt;&#xD;
  &lt;/info&gt;&#xD;
  &lt;para&gt;The latest version of&#xD;
    &lt;application&gt;&lt;xi:include href="definitions.001.xml" xpointer="product-name" set-xml-id=""/&gt;&lt;/application&gt; from&#xD;
    &lt;xi:include href="definitions.001.xml" xpointer="corp-name" set-xml-id=""/&gt;&#xD;
    is &lt;xi:include href="definitions.001.xml" xpointer="product-version" set-xml-id=""/&gt;.&lt;/para&gt;&#xD;
  &lt;para&gt;You can buy &lt;xi:include href="definitions.001.xml" xpointer="product-name" set-xml-id=""/&gt; in our on-line store.&lt;/para&gt;&#xD;
&lt;/article&gt;</code></pre><p>Result of transclusion:</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;
  &lt;info&gt;
      &lt;title&gt;Transclusions demo&lt;/title&gt;
  &lt;/info&gt;
  &lt;para&gt;The latest version of
    &lt;application&gt;
         &lt;phrase xml:base="definitions.001.xml"&gt;FooWiz&lt;/phrase&gt;
      &lt;/application&gt; from
    &lt;phrase xml:base="definitions.001.xml"&gt;ACME Inc.&lt;/phrase&gt;
    is &lt;phrase xml:base="definitions.001.xml"&gt;3.14&lt;/phrase&gt;.&lt;/para&gt;
  &lt;para&gt;You can buy &lt;phrase xml:base="definitions.001.xml"&gt;FooWiz&lt;/phrase&gt; in our on-line store.&lt;/para&gt;
&lt;/article&gt;
</code></pre></div></figure><p>Another new XInclude 1.1 feature lets you override
attributes on included content. <a href="#ex.4">Example A.4, “Overriding DocBook attributes on inclusion”</a> shows how to use this feature to
override effectivity attributes. This feature works by placing attributes from a specially
defined namespace (<code class="uri">http://www.w3.org/2001/XInclude/local-attributes</code>) on
the <code class="tag-element">xi:include</code> element. These attributes define the values that should be
used to replace attributes of the same name, but no namespace, in the transcluded content.</p><figure id="ex.4" class="example-wrapper"><div class="title">Example A.4. Overriding DocBook attributes on inclusion</div><div class="example"><p>Consider section (<code class="filename">section.001.xml</code>), which is
labeled for the Linux operating system (<code class="code">os="linux"</code>).</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;section xmlns="http://docbook.org/ns/docbook"
    version="5.0"
    os="linux"&gt;
    &lt;title&gt;Installation&lt;/title&gt;
    &lt;para&gt;Text&lt;/para&gt;
&lt;/section&gt;</code></pre><p>Now we want to include this section in another document and pretend that
it's actually targeted at a BSD system.</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;article xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:local="http://www.w3.org/2001/XInclude/local-attributes"
    version="5.0"&gt;
  &lt;title&gt;Sample article&lt;/title&gt;
  &lt;xi:include href="section.001.xml" local:os="bsd"/&gt;
&lt;/article&gt;</code></pre><p>The value of the <code class="code">local:os</code> attribute replaces the value of the
<code class="code">os</code> attribute during the XInclude process.</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;article xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;
  &lt;title&gt;Sample article&lt;/title&gt;
  &lt;section version="5.0" os="bsd" xml:base="section.001.xml"&gt;
      &lt;title&gt;Installation&lt;/title&gt;
      &lt;para&gt;Text&lt;/para&gt;
   &lt;/section&gt;
&lt;/article&gt;
</code></pre></div></figure></div></article><article id="tutorial" class="appendix"><header class="appendix-titlepage"><h2>B. Special ID/IDREF processing</h2></header><div class="content"><p>Transcluded content can contain <code class="tag-attribute">xml:id</code> attributes. If one fragment is
transcluded more than once, then the resulting document after transclusion will
contain duplicate IDs. The same problem can occur if the same ID is used in two different
transcluded modules. To overcome this problem, IDs and ID references
can be adjusted during the transclusion process.</p><p>The <code class="tag-attribute">trans:idfixup</code> attribute on
the <code class="tag-element">xi:include</code> element determines how IDs are adjusted during transclusion.</p><p>Of course, if IDs are adjusted then all corresponding ID references also have
to be adjusted.</p><p>These adjustments are controlled by the <code class="tag-attribute">trans:idfixup</code> and <code class="tag-attribute">trans:linkscope</code> attributes.
The following examples show the effect of using those two
attributes. Each example transcludes the procedure shown in <a href="#ex.5">Example B.1, “Module with sample procedure”</a>, which
contains one internal link and one external link.</p><figure id="ex.5" class="example-wrapper"><div class="title">Example B.1. Module with sample procedure</div><div class="example"><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;procedure xmlns="http://docbook.org/ns/docbook" xml:id="paper-insert"&gt;&#xD;
  &lt;title&gt;Inserting paper into printer&lt;/title&gt;&#xD;
  &lt;para&gt;This procedure is for printer owners.&#xD;
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  &#xD;
  &lt;step xml:id="s1"&gt;&lt;para&gt;Make sure that you have paper.&lt;/para&gt;&lt;/step&gt;&#xD;
  &lt;step&gt;&lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1"/&gt;&lt;/para&gt;&lt;/step&gt;&#xD;
&lt;/procedure&gt;</code></pre></div></figure><p><a href="#ex.6">Example B.2, “Automatic ID/IDREF adjustment”</a> transcludes this module twice to
show how we can deal with the duplicate ID problem.</p><figure id="ex.6" class="example-wrapper"><div class="title">Example B.2. Automatic ID/IDREF adjustment</div><div class="example"><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;
      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;
      xmlns:trans="http://docbook.org/ns/transclude"&#xD;
      version="5.0"&gt;&#xD;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;
  &lt;chapter xml:id="buy"&gt;&#xD;
    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;
    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Quick installation guide&lt;/title&gt;&#xD;
    &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;
    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;
    &lt;para&gt;If the green led is blinking, please add missing paper using the following procedure.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
&lt;/book&gt;</code></pre><p>Result of transclusion:</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;
  &lt;chapter xml:id="buy"&gt;
      &lt;title&gt;Buying printer&lt;/title&gt;
      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Quick installation guide&lt;/title&gt;
      &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;
      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e23"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1---d1e23"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e23"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
      &lt;/procedure&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Maintenance&lt;/title&gt;
      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;
      &lt;para&gt;If the green led is blinking, please add missing paper using the following procedure.&lt;/para&gt;
      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e56"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1---d1e56"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e56"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
      &lt;/procedure&gt;
  &lt;/chapter&gt;
&lt;/book&gt;
</code></pre></div></figure><p>Specifying <code class="tag-attribute">db:idfixup</code> triggers
the automatic ID/IDREF fixup. All IDs in the transcluded
modules are automatically suffixed to prevent ID collisions. Then,
IDREFs are fixed so that links point to the nearest possible
target. In <a href="#ex.6">Example B.2, “Automatic ID/IDREF adjustment”</a>, the link from step 2 to step 1 in the procedure always
points to the same instance of the procedure. However, the “<span class="quote">buy</span>”
link correctly points to the target in the main document.</p><p><a href="#ex.7">Example B.3, “Global linkscope”</a> uses <code class="literal">trans:linkscope="global"</code>
for the second transclusion. The result is that the link from step 2 in the second
procedure links to step 1 in the first procedure.</p><figure id="ex.7" class="example-wrapper"><div class="title">Example B.3. Global linkscope</div><div class="example"><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;
      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;
      xmlns:trans="http://docbook.org/ns/transclude"&#xD;
      version="5.0"&gt;&#xD;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;
  &lt;chapter xml:id="buy"&gt;&#xD;
    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;
    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Quick installation guide&lt;/title&gt;&#xD;
    &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;
    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;
    &lt;para&gt;If green led is blinking, please add paper using the following procedure.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto" trans:linkscope="global"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
&lt;/book&gt;</code></pre><p>Result of transclusion:</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;
  &lt;chapter xml:id="buy"&gt;
      &lt;title&gt;Buying printer&lt;/title&gt;
      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Quick installation guide&lt;/title&gt;
      &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;
      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e23"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1---d1e23"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e23"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
      &lt;/procedure&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Maintenance&lt;/title&gt;
      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;
      &lt;para&gt;If green led is blinking, please add paper using the following procedure.&lt;/para&gt;
      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e56"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1---d1e56"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e23"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
      &lt;/procedure&gt;
  &lt;/chapter&gt;
&lt;/book&gt;
</code></pre></div></figure><p><a href="#ex.8">Example B.4, “Local linkscope”</a> uses <code class="literal">db:linkscope="local"</code> on
the first transclusion. This means that every link from this transclusion must
point to an ID inside the transcluded content; no external links are allowed.
Because the transcluded content does contain a link to an external ID (“<span class="quote">buy</span>”),
this example is broken, since the transclusion process rewrites “<span class="quote">buy</span>”
to be “<span class="quote">buy---d1e23</span>”, for which there is no corresponding target.</p><p>This method of transclusion can be useful if you are
transcluding foreign content and want to isolate its links from the rest of your document.</p><figure id="ex.8" class="example-wrapper"><div class="title">Example B.4. Local linkscope</div><div class="example"><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;
      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;
      xmlns:trans="http://docbook.org/ns/transclude"&#xD;
      version="5.0"&gt;&#xD;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;
  &lt;chapter xml:id="buy"&gt;&#xD;
    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;
    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Quick installation guide&lt;/title&gt;&#xD;
    &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto" trans:linkscope="local"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;
    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;
    &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.001.xml" trans:idfixup="auto"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
&lt;/book&gt;</code></pre><p>Result of transclusion:</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;
  &lt;chapter xml:id="buy"&gt;
      &lt;title&gt;Buying printer&lt;/title&gt;
      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Quick installation guide&lt;/title&gt;
      &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;
      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e23"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy---d1e23"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1---d1e23"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e23"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
      &lt;/procedure&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Maintenance&lt;/title&gt;
      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;
      &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;
      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert---d1e56"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1---d1e56"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1---d1e56"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
      &lt;/procedure&gt;
  &lt;/chapter&gt;
&lt;/book&gt;
</code></pre></div></figure><p>You can manually assign the value of the suffix used in transcluded content.
<a href="#ex.9">Example B.5, “Manually assigned suffix”</a> shows how to do this.</p><div class="remark">Although suffixes seem to be a better approach for automatically
generated IDs, prefixes may be a better approach for manually specified IDs
(for example when HTML filenames are generated based on the xml:id
value). Should we put the prefix option back in the
specification?</div><figure id="ex.9" class="example-wrapper"><div class="title">Example B.5. Manually assigned suffix</div><div class="example"><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;
      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;
      xmlns:trans="http://docbook.org/ns/transclude"&#xD;
      version="5.0"&gt;&#xD;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;
  &lt;chapter xml:id="buy"&gt;&#xD;
    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;
    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Quick installation guide&lt;/title&gt;&#xD;
    &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.001.xml" trans:idfixup="suffix" trans:suffix="_install-proc"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;
    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;
    &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.001.xml" trans:idfixup="suffix" trans:suffix="_maintain-proc"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
&lt;/book&gt;</code></pre><p>Result of transclusion:</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;
  &lt;chapter xml:id="buy"&gt;
      &lt;title&gt;Buying printer&lt;/title&gt;
      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Quick installation guide&lt;/title&gt;
      &lt;para&gt;Carefully follow all procedures below.&lt;/para&gt;
      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert_install-proc"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1_install-proc"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1_install-proc"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
      &lt;/procedure&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Maintenance&lt;/title&gt;
      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;
      &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;
      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert_maintain-proc"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1_maintain-proc"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1_maintain-proc"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
      &lt;/procedure&gt;
  &lt;/chapter&gt;
&lt;/book&gt;
</code></pre></div></figure><p>By default, XInclude does not do any postprocessing.
Thus, the resulting document in <a href="#ex.10">Example B.6, “Disabling ID fixup”</a> contains duplicate IDs and is not valid.</p><figure id="ex.10" class="example-wrapper"><div class="title">Example B.6. Disabling ID fixup</div><div class="example"><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;
      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;
      version="5.0"&gt;&#xD;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;
  &lt;chapter xml:id="buy"&gt;&#xD;
    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;
    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Quick installation guide&lt;/title&gt;&#xD;
    &lt;para&gt;Carefully follow all procedures bellow.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.001.xml"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;
    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;
    &lt;para&gt;If green led is blinking, please add missing paper using the following procedure.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.001.xml"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
&lt;/book&gt;</code></pre><p>Result of transclusion:</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;
  &lt;chapter xml:id="buy"&gt;
      &lt;title&gt;Buying printer&lt;/title&gt;
      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Quick installation guide&lt;/title&gt;
      &lt;para&gt;Carefully follow all procedures bellow.&lt;/para&gt;
      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
      &lt;/procedure&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Maintenance&lt;/title&gt;
      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;
      &lt;para&gt;If green led is blinking, please add missing paper using the following procedure.&lt;/para&gt;
      &lt;procedure xml:base="procedure.001.xml" xml:id="paper-insert"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
      &lt;/procedure&gt;
  &lt;/chapter&gt;
&lt;/book&gt;
</code></pre></div></figure><figure id="ex.11" class="example-wrapper"><div class="title">Example B.7. Chaining suffixes</div><div class="example"><p>Suppose we have note in a separate file
(<code class="filename">note.001.xml</code>):</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;note xmlns="http://docbook.org/ns/docbook" xml:id="note"&gt;
  &lt;para&gt;Important note.&lt;/para&gt;
&lt;/note&gt;</code></pre><p>We transclude it into another file
(<code class="filename">procedure.002.xml</code>) assigning a suffix manually:</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;procedure xmlns="http://docbook.org/ns/docbook" xml:id="paper-insert"&#xD;
  xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;
  xmlns:trans="http://docbook.org/ns/transclude"&gt;&#xD;
  &lt;title&gt;Inserting paper into printer&lt;/title&gt;&#xD;
  &lt;para&gt;This procedure is for printer owners.&#xD;
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  &#xD;
  &lt;step xml:id="s1"&gt;&lt;para&gt;Make sure that you have paper.&lt;/para&gt;&lt;/step&gt;&#xD;
  &lt;step&gt;&lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1"/&gt;&lt;/para&gt;&lt;/step&gt;&#xD;
  &lt;step&gt;&#xD;
    &lt;xi:include href="note.001.xml" trans:idfixup="suffix" trans:suffix="_note001"/&gt;&#xD;
  &lt;/step&gt;  &#xD;
&lt;/procedure&gt;</code></pre><p>Then we transclude this procedure into a master document,
again with a manually specified suffix:</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#xD;
&lt;book xmlns="http://docbook.org/ns/docbook"&#xD;
      xmlns:xi="http://www.w3.org/2001/XInclude"&#xD;
      xmlns:trans="http://docbook.org/ns/transclude"&#xD;
      version="5.0"&gt;&#xD;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;&#xD;
  &lt;chapter xml:id="buy"&gt;&#xD;
    &lt;title&gt;Buying printer&lt;/title&gt;&#xD;
    &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;&#xD;
  &lt;/chapter&gt;&#xD;
  &lt;chapter&gt;&#xD;
    &lt;title&gt;Maintenance&lt;/title&gt;&#xD;
    &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;&#xD;
    &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;&#xD;
    &lt;xi:include href="procedure.002.xml" trans:idfixup="suffix" trans:suffix="_procedure002"/&gt;&#xD;
  &lt;/chapter&gt;&#xD;
&lt;/book&gt;</code></pre><p>The result is that the ID in the transcluded note contains a chained
suffix “<span class="quote">note_procedure002_note001</span>”:</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;book xmlns="http://docbook.org/ns/docbook" version="5.0"&gt;
  &lt;title&gt;Definitive Printer Guide&lt;/title&gt;
  &lt;chapter xml:id="buy"&gt;
      &lt;title&gt;Buying printer&lt;/title&gt;
      &lt;para&gt;Grab money, go to shop, ...&lt;/para&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
      &lt;title&gt;Maintenance&lt;/title&gt;
      &lt;para&gt;Be friendly to your printer when you speak to it.&lt;/para&gt;
      &lt;para&gt;If the green led is blinking, please add paper using the following procedure.&lt;/para&gt;
      &lt;procedure xml:base="procedure.002.xml" xml:id="paper-insert_procedure002"&gt;
         &lt;title&gt;Inserting paper into printer&lt;/title&gt;
         &lt;para&gt;This procedure is for printer owners.
    If you don't have a printer, consider &lt;link linkend="buy"&gt;buying one&lt;/link&gt;.&lt;/para&gt;  
         &lt;step xml:id="s1_procedure002"&gt;
            &lt;para&gt;Make sure that you have paper.&lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;para&gt;Insert paper into printer. If you don't have paper, consult &lt;xref linkend="s1_procedure002"/&gt;
            &lt;/para&gt;
         &lt;/step&gt;
         &lt;step&gt;
            &lt;note xml:base="note.001.xml" xml:id="note_procedure002_note001"&gt;
               &lt;para&gt;Important note.&lt;/para&gt;
            &lt;/note&gt;
         &lt;/step&gt;  
      &lt;/procedure&gt;
  &lt;/chapter&gt;
&lt;/book&gt;
</code></pre></div></figure></div></article><article id="schema" class="appendix"><header class="appendix-titlepage"><h2>C. DocBook schema with support for transclusions</h2></header><div class="content"><p>TBD</p></div></article><article id="transclusion-processor" class="appendix"><header class="appendix-titlepage"><h2>D. Sample transclusion processor written in XSLT 2.0</h2></header><div class="content"><p>Please note that this sample transclusion processor is not yet
feature complete. It supports only a subset of the proposal.</p><pre class="programlisting language-none"><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&#xD;
&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="2.0"&#xD;
                xmlns:f="http://docbook.org/xslt/ns/extension"&#xD;
                xmlns:mp="http://docbook.org/xslt/ns/mode/private"&#xD;
                xmlns:db="http://docbook.org/ns/docbook"&#xD;
                xmlns:xs="http://www.w3.org/2001/XMLSchema"&#xD;
                xmlns:ta="http://docbook.org/ns/transclude"&#xD;
                xmlns:xia="http://www.w3.org/2001/XInclude/local-attributes"&#xD;
                exclude-result-prefixes="f mp xs ta xia"&gt;&#xD;
&#xD;
&lt;!-- Remove for production files, pretty print can harm mixed content --&gt;&#xD;
&lt;xsl:output indent="yes"/&gt;&#xD;
&#xD;
&lt;xsl:template match="/"&gt;&#xD;
  &lt;xsl:variable name="adjusted" select="f:adjust-ids(/)"/&gt;&#xD;
  &lt;xsl:variable name="result" select="f:adjust-idrefs($adjusted)"/&gt;&#xD;
  &lt;xsl:sequence select="f:transclude-cleanup($result)"/&gt;&#xD;
&lt;/xsl:template&gt;&#xD;
&#xD;
&lt;!-- Separator for auto generated suffixes --&gt;&#xD;
&lt;xsl:param name="psep" select="'---'"/&gt;&#xD;
&#xD;
&lt;!-- Function and mode for changing IDs based on provided suffix --&gt;&#xD;
&lt;xsl:function name="f:adjust-ids" as="node()+"&gt;&#xD;
  &lt;xsl:param name="doc" as="node()+"/&gt;&#xD;
&#xD;
  &lt;xsl:apply-templates select="$doc" mode="mp:transclude"/&gt;&#xD;
&lt;/xsl:function&gt;&#xD;
&#xD;
&lt;xsl:template match="node()" mode="mp:transclude"&gt;&#xD;
  &lt;xsl:param name="idfixup" select="'none'" tunnel="yes"/&gt;&#xD;
  &lt;xsl:param name="suffix" tunnel="yes"/&gt;&#xD;
  &lt;xsl:copy&gt;&#xD;
    &lt;xsl:copy-of select="@* except @xml:id"/&gt;&#xD;
    &lt;xsl:if test="@xml:id"&gt;&#xD;
      &lt;xsl:choose&gt;&#xD;
        &lt;xsl:when test="($idfixup = 'none')"&gt;&#xD;
          &lt;xsl:copy-of select="@xml:id"/&gt;&#xD;
        &lt;/xsl:when&gt;&#xD;
        &lt;xsl:otherwise&gt;&#xD;
          &lt;xsl:attribute name="xml:id" select="concat(@xml:id, $suffix)"/&gt;&#xD;
        &lt;/xsl:otherwise&gt;&#xD;
      &lt;/xsl:choose&gt;&#xD;
    &lt;/xsl:if&gt;&#xD;
    &lt;xsl:apply-templates mode="mp:transclude"/&gt;&#xD;
  &lt;/xsl:copy&gt;&#xD;
&lt;/xsl:template&gt;&#xD;
&#xD;
&lt;xsl:template match="node()[@ta:*]" mode="mp:transclude"&gt;&#xD;
  &lt;xsl:param name="idfixup" select="'none'" tunnel="yes"/&gt;&#xD;
  &lt;xsl:param name="suffix" tunnel="yes"/&gt;&#xD;
&#xD;
  &lt;xsl:variable name="new-idfixup" select="if (@ta:idfixup) then @ta:idfixup else $idfixup"/&gt;&#xD;
  &lt;xsl:variable name="linkscope" select="if (@ta:linkscope) then @ta:linkscope else 'near'"/&gt;&#xD;
  &lt;xsl:variable name="new-suffix"&gt;&#xD;
    &lt;xsl:choose&gt;&#xD;
      &lt;xsl:when test="$new-idfixup = 'auto'"&gt;&#xD;
        &lt;xsl:sequence select="concat($psep, generate-id(.))"/&gt;&#xD;
      &lt;/xsl:when&gt;&#xD;
      &lt;xsl:when test="$new-idfixup = 'suffix'"&gt;&#xD;
        &lt;xsl:sequence select="concat($suffix, @ta:suffix)"/&gt;&#xD;
      &lt;/xsl:when&gt;&#xD;
      &lt;xsl:otherwise&gt;&lt;/xsl:otherwise&gt;&#xD;
    &lt;/xsl:choose&gt;&#xD;
  &lt;/xsl:variable&gt;&#xD;
&#xD;
  &lt;xsl:copy&gt;&#xD;
    &lt;xsl:copy-of select="@* except @xml:id"/&gt;&#xD;
    &lt;xsl:if test="@xml:id"&gt;&#xD;
      &lt;xsl:choose&gt;&#xD;
        &lt;xsl:when test="($new-idfixup = 'none')"&gt;&#xD;
          &lt;xsl:copy-of select="@xml:id"/&gt;&#xD;
        &lt;/xsl:when&gt;&#xD;
        &lt;xsl:otherwise&gt;&#xD;
          &lt;xsl:attribute name="xml:id" select="concat(@xml:id, $new-suffix)"/&gt;&#xD;
        &lt;/xsl:otherwise&gt;&#xD;
      &lt;/xsl:choose&gt;&#xD;
    &lt;/xsl:if&gt;&#xD;
    &lt;xsl:attribute name="ta:suffix" select="$new-suffix"/&gt;&#xD;
    &lt;xsl:apply-templates mode="mp:transclude"&gt;&#xD;
      &lt;xsl:with-param name="idfixup" select="$new-idfixup" tunnel="yes"/&gt;&#xD;
      &lt;xsl:with-param name="suffix" select="$new-suffix" tunnel="yes"/&gt;&#xD;
    &lt;/xsl:apply-templates&gt;&#xD;
  &lt;/xsl:copy&gt;  &#xD;
&lt;/xsl:template&gt;&#xD;
&#xD;
&lt;!-- Function and mode for adjusting references to IDs --&gt;&#xD;
&lt;xsl:function name="f:adjust-idrefs" as="node()+"&gt;&#xD;
  &lt;xsl:param name="doc" as="node()+"/&gt;&#xD;
&#xD;
  &lt;xsl:apply-templates select="$doc" mode="mp:adjust-idrefs"/&gt;&#xD;
&lt;/xsl:function&gt;&#xD;
&#xD;
&lt;xsl:template match="node()|@*" mode="mp:adjust-idrefs"&gt;&#xD;
  &lt;xsl:copy&gt;&#xD;
    &lt;xsl:apply-templates select="@* | node()" mode="mp:adjust-idrefs"/&gt;&#xD;
  &lt;/xsl:copy&gt;&#xD;
&lt;/xsl:template&gt;&#xD;
&#xD;
&lt;!-- FIXME: add support for @linkends, @zone, @arearefs --&gt;&#xD;
&lt;!-- FIEMX: add support for xlink:href starting with # --&gt;&#xD;
&lt;xsl:template match="@linkend | @endterm | @otherterm | @startref" mode="mp:adjust-idrefs"&gt;&#xD;
  &lt;xsl:variable name="idref" select="."/&gt;&#xD;
&#xD;
  &lt;xsl:variable name="annotation" select="ancestor-or-self::*[@ta:linkscope][1]"/&gt;&#xD;
  &lt;xsl:variable name="linkscope" select="($annotation/@ta:linkscope, 'near')[1]"/&gt;&#xD;
  &lt;xsl:variable name="suffix" select="$annotation/@ta:suffix"/&gt;&#xD;
&#xD;
  &lt;xsl:attribute name="{local-name(.)}"&gt;&#xD;
    &lt;xsl:choose&gt;&#xD;
      &lt;xsl:when test="$linkscope = 'user'"&gt;&#xD;
        &lt;xsl:value-of select="$idref"/&gt;&#xD;
      &lt;/xsl:when&gt;&#xD;
      &lt;xsl:when test="$linkscope = 'local'"&gt;&#xD;
        &lt;xsl:value-of select="concat($idref, $suffix)"/&gt;&#xD;
      &lt;/xsl:when&gt;&#xD;
      &lt;xsl:when test="$linkscope = 'near'"&gt;&#xD;
        &lt;xsl:value-of select="f:nearest-matching-id($idref, ..)"/&gt;&#xD;
      &lt;/xsl:when&gt;&#xD;
      &lt;xsl:when test="$linkscope = 'global'"&gt;&#xD;
        &lt;xsl:value-of select="f:nearest-matching-id($idref, root(.))"/&gt;&#xD;
      &lt;/xsl:when&gt;&#xD;
    &lt;/xsl:choose&gt;&#xD;
  &lt;/xsl:attribute&gt;&#xD;
&lt;/xsl:template&gt;&#xD;
&#xD;
&lt;!-- Function searches nearest matching ID in a given context --&gt;&#xD;
&lt;xsl:function name="f:nearest-matching-id" as="xs:string?"&gt;&#xD;
  &lt;xsl:param name="idref" as="xs:string"/&gt;&#xD;
  &lt;xsl:param name="context" as="node()"/&gt;&#xD;
&#xD;
  &lt;!-- FIXME: key() requires document-node() rooted subtree --&gt;&#xD;
  &lt;!--  &lt;xsl:variable name="targets" select="key('unprefixed-id', f:unprefixed-id($idref, $context), $context)"/&gt; --&gt;&#xD;
  &lt;xsl:variable name="targets" select="$context//*[@xml:id][f:unprefixed-id(@xml:id, .) eq f:unprefixed-id($idref, $context)]"/&gt; &#xD;
&#xD;
  &lt;xsl:choose&gt;&#xD;
    &lt;xsl:when test="not($targets) and $context/.."&gt;&#xD;
      &lt;xsl:sequence select="f:nearest-matching-id($idref, $context/..)"/&gt;&#xD;
    &lt;/xsl:when&gt;&#xD;
    &lt;xsl:when test="$targets"&gt;&#xD;
      &lt;xsl:sequence select="$targets[1]/string(@xml:id)"/&gt;&#xD;
    &lt;/xsl:when&gt;&#xD;
    &lt;xsl:otherwise&gt;&#xD;
      &lt;xsl:message&gt;Error: no matching ID for reference "&lt;xsl:value-of select="$idref"/&gt;" was found.&lt;/xsl:message&gt;&#xD;
    &lt;/xsl:otherwise&gt;&#xD;
  &lt;/xsl:choose&gt;&#xD;
&lt;/xsl:function&gt;&#xD;
&#xD;
&lt;!-- FIXME: type annotation should be without ?, find why it is called with empty sequence --&gt;&#xD;
&lt;xsl:function name="f:unprefixed-id" as="xs:string?"&gt;&#xD;
  &lt;xsl:param name="id" as="xs:string?"/&gt;&#xD;
  &lt;xsl:param name="context" as="node()"/&gt;&#xD;
  &#xD;
  &lt;xsl:variable name="suffix" select="$context/ancestor-or-self::*[@ta:suffix][1]/@ta:suffix"/&gt;&#xD;
&#xD;
  &lt;xsl:sequence select="if ($suffix) then substring-before($id, $suffix) else $id"/&gt;&#xD;
&lt;/xsl:function&gt;&#xD;
&#xD;
&lt;!--&#xD;
&lt;xsl:key name="unprefixed-id" match="*[@xml:id]" use="f:unprefixed-id(@xml:id, .)"/&gt;&#xD;
--&gt;&#xD;
&#xD;
&lt;!-- Function and mode for removing transclusion attributes from the final output --&gt;&#xD;
&lt;xsl:function name="f:transclude-cleanup" as="node()+"&gt;&#xD;
  &lt;xsl:param name="doc" as="node()+"/&gt;&#xD;
  &#xD;
  &lt;xsl:apply-templates select="$doc" mode="mp:transclude-cleanup"/&gt;&#xD;
&lt;/xsl:function&gt;&#xD;
  &#xD;
&lt;xsl:template match="node()" mode="mp:transclude-cleanup"&gt;&#xD;
  &lt;xsl:copy&gt;&#xD;
    &lt;xsl:apply-templates mode="mp:transclude-cleanup"/&gt;&#xD;
  &lt;/xsl:copy&gt;&#xD;
&lt;/xsl:template&gt;      &#xD;
&#xD;
&lt;xsl:template match="*" mode="mp:transclude-cleanup" priority="10"&gt;&#xD;
  &lt;xsl:element name="{name()}" namespace="{namespace-uri()}"&gt;&#xD;
    &lt;xsl:copy-of select="@* except @ta:*"/&gt;&#xD;
    &lt;xsl:apply-templates mode="mp:transclude-cleanup"/&gt;&#xD;
  &lt;/xsl:element&gt;&#xD;
&lt;/xsl:template&gt;      &#xD;
  &#xD;
&lt;/xsl:stylesheet&gt;</code></pre></div></article><article id="bibliography" class="bibliography"><header class="bibliography-titlepage"><h3>Bibliography</h3></header><div id="XI11" class="bibliomixed"><p class="bibliomixed"><span class="label">[XI11] </span><span class="entry">
  <span class="title"><cite>XML Inclusions (XInclude) Version 1.1</cite></span>.
  W3C Last Call Working Draft.
  <span class="pubdate">16 December 2014.</span>
  <span class="bibliosource">Available at <a href="https://www.w3.org/TR/2014/WD-xinclude-11-20141216/">https://www.w3.org/TR/2014/WD-xinclude-11-20141216/</a></span>.</span></p></div></article></div><div class="footnotes"><hr width="100" align="left" class="footnotes-divider" /><div class="footnote"><div class="footnote-wrapper"><div class="footnote-symbol-wrapper"><p><sup><span class="osq">[</span><a href="#idfixup-attribute.2.1.3.2.1.2" id="ftn.idfixup-attribute.2.1.3.2.1.2">1</a><span class="csq">]</span></sup> </p></div><div class="footnote-body-wrapper"><p>For example, XSLT-based
implementations can use the <code class="function">generate-id()</code> function to
generate a unique suffix.</p></div></div></div></div></article><script src="https://cdn.docbook.org/resources/2.1.1/js/prism.js"></script></body></html>